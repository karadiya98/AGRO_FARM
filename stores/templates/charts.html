<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Details & Tracking</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Open+Sans:wght@400;600&display=swap');

        :root {
            --primary-blue: #007bff;
            --primary-orange: #fd7e14;
            --dark-grey: #212529;
            --light-grey: #f8f9fa;
            --text-grey: #6c757d;
            --border-color: #dee2e6;
            --status-pending: #ffc107;
            --status-shipped: #17a2b8;
            --status-delivered: #28a745;
            --status-cancelled: #dc3545;
            --agro-green: #28a745; /* Consistent green for Agro theme */
            --agro-light-green: #e0ffe0; /* Light green for borders/backgrounds */
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0fff0; /* Very light, fresh green background */
            color: var(--dark-grey);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-y: hidden; /* Prevent body scroll, container handles it */
        }

        .main-wrapper {
            display: flex;
            flex-grow: 1; /* Allows it to take up available vertical space */
            width: 100%;
            max-width: 1200px; /* Increased max-width for more horizontal space */
            margin: 20px auto; /* Centered with some top/bottom margin */
            padding: 0 20px; /* Padding on sides */
            box-sizing: border-box; /* Include padding in width calculation */
        }

        .column {
            flex: 1; /* Each column takes equal space */
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
            margin: 0 10px; /* Space between columns */
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* Allow column to scroll if content is too long */
            max-height: calc(100vh - 80px); /* Adjust max-height to fit viewport, considering header/footer if any */
            animation: fadeIn 0.8s ease-out;
        }

        /* Adjust animation for individual columns */
        .column:first-child { animation-delay: 0.1s; }
        .column:last-child { animation-delay: 0.2s; }


        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: var(--dark-grey);
            font-size: 32px;
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            padding-bottom: 10px;
        }
        h1::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background-color: var(--agro-green); /* Changed to green */
            border-radius: 5px;
        }

        h2 {
            font-size: 24px;
            margin-top: 0;
            margin-bottom: 20px;
            color: var(--agro-green); /* Changed to green */
            border-bottom: 2px solid var(--agro-light-green); /* Light green border */
            padding-bottom: 10px;
        }

        .order-summary, .tracking-details {
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        .order-summary {
            flex-grow: 0; /* Don't grow, take content height */
            flex-shrink: 0;
        }
        .tracking-details {
            flex-grow: 1; /* Allow tracking details to take remaining space */
            display: flex;
            flex-direction: column;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .summary-item {
            padding: 15px;
            border-radius: 8px;
            background-color: var(--light-grey);
            border: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .summary-item strong {
            display: block;
            margin-bottom: 8px;
            color: var(--text-grey);
            font-size: 15px;
            text-transform: uppercase;
        }

        .summary-item span {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark-grey);
        }
        .summary-item .status-text {
            font-size: 18px;
            font-weight: 700;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
        }

        /* Status Colors */
        .status-placed { background-color: #e0f7fa; color: #007bff; }
        .status-processing { background-color: #fff3cd; color: #ffc107; }
        .status-shipped { background-color: #e0f2f7; color: #17a2b8; }
        .status-out-for-delivery { background-color: #d1ecf1; color: #0d6efd; }
        .status-delivered { background-color: var(--agro-light-green); color: var(--agro-green); } /* Changed to green */
        .status-cancelled { background-color: #f8d7da; color: var(--status-cancelled); }


        .product-list {
            list-style: none;
            padding: 0;
            margin-top: 15px;
            flex-grow: 1; /* Allow product list to grow */
            overflow-y: auto; /* Enable scrolling for product list within its container */
        }

        .product-item {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #eee;
        }
        .product-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }

        .product-item img {
            width: 90px;
            height: 90px;
            object-fit: cover;
            margin-right: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .product-info {
            flex-grow: 1;
        }

        .product-info h3 {
            margin: 0 0 8px 0;
            font-size: 20px;
            color: var(--dark-grey);
        }

        .product-info p {
            margin: 0 0 4px 0;
            color: var(--text-grey);
            font-size: 15px;
        }

        .product-info .price {
            font-weight: 700;
            color: var(--primary-orange);
            font-size: 18px;
        }

        /* Tracking Chart/Timeline */
        .tracking-timeline {
            display: flex;
            height: fit-content;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 30px;
            position: relative;
            padding: 0 20px;
        }

        .tracking-timeline::before {
            content: '';
            position: absolute;
            top: 22px;
            left: 40px;
            right: 40px;
            height: 4px;
            background-color: #e0e0e0;
            z-index: 1;
            border-radius: 2px;
        }

        .tracking-timeline .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
            text-align: center;
        }

        .tracking-timeline .step .icon {
            background-color: #e0e0e0;
            color: white;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-bottom: 12px;
            transition: background-color 0.4s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .tracking-timeline .step.completed .icon {
            background-color: var(--primary-orange);
            transform: scale(1.1);
        }
        .tracking-timeline .step.active .icon {
            background-color: var(--primary-blue);
            transform: scale(1.15);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
        }
        .tracking-timeline .step.delivered .icon {
            background-color: var(--status-delivered);
            transform: scale(1.15);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }

        .tracking-timeline .step .label {
            font-size: 15px;
            text-align: center;
            color: var(--text-grey);
            font-weight: 600;
            transition: color 0.4s ease;
        }
        .tracking-timeline .step.active .label {
            color: var(--primary-blue);
        }
        .tracking-timeline .step.completed .label,
        .tracking-timeline .step.delivered .label {
            color: var(--dark-grey);
        }

        /* Placeholder for actual chart (if using Chart.js etc.) */
        .chart-placeholder {
            text-align: center;
            margin-top: 40px;
            border: 2px dashed var(--border-color);
            padding: 30px;
            border-radius: 10px;
            color: var(--text-grey);
            font-style: italic;
            background-color: #fcfcfc;
        }
        .chart-placeholder p {
            font-size: 1.1em;
            margin-bottom: 20px;
        }
        .chart-placeholder img {
            border: 1px solid #ddd;
        }

        /* Download Button Container */
        .download-button-container {
            text-align: center;
            margin-top: auto; /* Pushes button to the bottom of its column */
            padding-top: 25px;
            border-top: 1px solid var(--border-color);
            display: none;
        }

        .download-button {
            background-color: var(--agro-green); /* Green button */
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 30px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.2); /* Green shadow */
        }

        .download-button:hover {
            background-color: #1e7e34; /* Darker green on hover */
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(40, 167, 69, 0.3);
        }

        /* Responsive adjustments for the main layout */
        @media (max-width: 992px) { /* Adjust breakpoint for two columns */
            .main-wrapper {
                flex-direction: column; /* Stack columns vertically on smaller screens */
                padding: 0 15px;
                margin: 15px auto;
            }
            .column {
                margin: 10px 0; /* Space between stacked columns */
                max-height: none; /* Remove max-height for stacked columns */
                overflow-y: visible; /* Allow normal scrolling */
            }
        }

        @media (max-width: 768px) {
            h1 { font-size: 28px; }
            h2 { font-size: 22px; }
            .summary-grid {
                grid-template-columns: 1fr;
            }
            .tracking-timeline {
                flex-wrap: wrap;
                justify-content: center;
                padding: 0;
            }
            .tracking-timeline::before {
                display: none;
            }
            .tracking-timeline .step {
                width: 45%;
                margin-bottom: 25px;
            }
            .tracking-timeline .step .icon {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
        }

        @media (max-width: 480px) {
            h1 { font-size: 24px; }
            .product-item {
                flex-direction: column;
                align-items: flex-start;
                text-align: left;
            }
            .product-item img {
                margin-bottom: 10px;
                margin-right: 0;
            }
            .tracking-timeline .step {
                width: 90%;
            }
            .summary-item span, .product-info .price, .download-button { font-size: 16px; }
        }

        /* Creative Bill Design Styles (remains mostly as is, but ensuring consistent green) */
        .invoice-container {
            max-width: 850px;
            margin: 30px auto;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 40px;
            border-top: 5px solid var(--agro-green); /* Changed to green for Agro theme */
        }
        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .invoice-header h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 36px;
            color: var(--agro-green); /* Changed to green */
            margin: 0;
            text-align: left;
            flex-grow: 1;
        }
        .company-info {
            text-align: right;
            font-size: 13px;
            line-height: 1.6;
        }
        .company-info strong {
            font-size: 16px;
            color: #555;
        }

        .billing-shipping-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .billing-shipping-info > div {
            flex: 1;
            min-width: 250px;
            padding-right: 20px;
            line-height: 1.6;
        }
        .billing-shipping-info h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 18px;
            color: #555;
            margin-bottom: 10px;
            border-bottom: 2px solid var(--agro-light-green); /* Light green border */
            padding-bottom: 5px;
        }

        .invoice-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            background-color: #f0fff0; /* Very light green background */
            padding: 15px 20px;
            border-radius: 8px;
            border: 1px solid #d4edda; /* Greenish border */
        }
        .invoice-details div {
            flex: 1;
            text-align: center;
            padding: 0 10px;
        }
        .invoice-details strong {
            display: block;
            font-size: 13px;
            color: #777;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        .invoice-details span {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        .items-table th, .items-table td {
            border: 1px solid #eee;
            padding: 12px 15px;
            text-align: left;
        }
        .items-table th {
            background-color: var(--agro-green); /* Green header */
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 13px;
        }
        .items-table tbody tr:nth-child(even) {
            background-color: #f9fff9; /* Lighter stripe for even rows */
        }
        .items-table td:nth-child(1) {
             text-align: left;
        }
        .items-table td:nth-child(2) { text-align: center; }
        .items-table td:nth-child(3), .items-table td:nth-child(4) { text-align: right; }

        .totals-section {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 30px;
        }
        .totals-table {
            width: 300px;
            border-collapse: collapse;
        }
        .totals-table tr td {
            padding: 8px 15px;
            border: none;
            text-align: right;
        }
        .totals-table tr:last-child td {
            border-top: 2px solid var(--agro-green); /* Green total border */
            font-size: 1.3em;
            font-weight: bold;
            color: var(--agro-green); /* Green total text */
        }
        .totals-table td:first-child {
            text-align: left;
            color: #555;
        }

        .footer-note {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px dashed #ddd;
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }
        .footer-note a {
            color: #007bff;
            text-decoration: none;
        }
        .footer-note a:hover {
            text-decoration: underline;
        }

        /* Responsive adjustments for the bill itself */
        @media (max-width: 600px) {
            .invoice-container {
                padding: 20px;
            }
            .invoice-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            .company-info {
                text-align: center;
                margin-top: 15px;
            }
            .billing-shipping-info {
                flex-direction: column;
            }
            .billing-shipping-info > div {
                padding-right: 0;
                margin-bottom: 20px;
            }
            .invoice-details {
                flex-direction: column;
                text-align: center;
            }
            .invoice-details div {
                margin-bottom: 10px;
            }
            .items-table th, .items-table td {
                padding: 8px 10px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <h1>Order Details and Tracking</h1>
    <div class="main-wrapper">
        <div class="column">
            <div class="order-summary">
                <h2>Order Summary</h2>
                <div class="summary-grid">
                    <div class="summary-item">
                        <strong>Customer name</strong>
                        <span>{{profile_name}}</span>
                    </div>

                    <div class="summary-item">
                        <strong>Order ID:</strong>
                        <span id="orderIdDisplay">#N/A</span>
                    </div>


                    <div class="summary-item">
                        <strong>Order Date:</strong>
                        <span id="orderDateDisplay">NA</span>
                    </div>


                    <div class="summary-item">
                        <strong>Total:</strong>
                        <span id="orderTotalDisplay">₹0.00</span>
                    </div>
                    
                    <div class="summary-item">
                        <strong>Payment:</strong>
                        <span id="paymentMethodDisplay">N/A</span>
                    </div>
                    <div class="summary-item">
                        <strong>Delivered from</strong>
                        <span id="shippingAddressDisplay">N/A</span>
                    </div>
                    <div class="summary-item">
                        <strong>Status:</strong>
                        <span id="currentOrderStatus" class="status-text">N/A</span>
                    </div>
                </div>
            </div>

            <div class="tracking-details">
                <h2>Items in this order</h2>
                <ul class="product-list" id="productList">
                    </ul>
            </div>
        </div>

        <div class="column">
            <div class="tracking-details">
                <h2>Tracking Updates</h2>
                <p><strong>Estimated Delivery:</strong> <span id="estimatedDeliveryDisplay">N/A</span></p>

                <div class="tracking-timeline">
                    <div class="step" id="step-placed">
                        <div class="icon"><i class="fa-solid fa-clipboard-list"></i></div>
                        <div class="label">Order Placed</div>
                    </div>
                    <div class="step" id="step-processing">
                        <div class="icon"><i class="fa-solid fa-hourglass-start"></i></div>
                        <div class="label">Processing</div>
                    </div>
                    <div class="step" id="step-shipped">
                        <div class="icon"><i class="fa-solid fa-truck-ramp-box"></i></div>
                        <div class="label">Shipped</div>
                    </div>
                    <div class="step" id="step-out-for-delivery">
                        <div class="icon"><i class="fa-solid fa-truck-fast"></i></div>
                        <div class="label">Out for Delivery</div>
                    </div>
                    <div class="step" id="step-delivered">
                        <div class="icon"><i class="fa-solid fa-house-chimney"></i></div>
                        <div class="label">Delivered</div>
                    </div>
                </div>

                <!-- <div class="chart-placeholder">
                    <p>
                        <i class="fa-solid fa-chart-line" style="margin-right: 10px;"></i>
                        Visualizing your order journey.
                    </p>
                    <img src="https://via.placeholder.com/600x200?text=Order+Status+Chart+Placeholder" alt="Order Status Chart" style="max-width: 100%; height: auto; margin-top: 15px; border-radius: 5px;">
                </div> -->

                <div class="download-button-container" id="downloadButtonContainer">
                    <button class="download-button" onclick="downloadOrderBillHtml(currentOrderData)">Download Order Bill</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentOrderData = null;
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const encodedOrderData = urlParams.get('orderData');
            
        

            if (encodedOrderData) {
                try {
                    const orderData = JSON.parse(decodeURIComponent(encodedOrderData));
                    currentOrderData = orderData;
                    populateOrderDetails(orderData);
                    updateTrackingTimeline(orderData.status);
                    renderProductList(orderData.products);
                    toggleDownloadButton(orderData.status);

                   
                    



                } catch (e) {
                    console.error("Failed to parse order data from URL:", e);
                }
            } else {
                console.warn("No order data found in URL parameters. Displaying default/empty state.");
                // Example of default data if no URL parameter is provided for testing:
                const defaultOrder = {
                    orderId: '#AD123456',
                    orderDate: 'May 30, 2024',
                    total: 1250.00,
                    payment: 'Credit Card',
                    shippingAddress: '123 Green Lane, Farmville, Agronomia - 567890',
                    status: 'Delivered',
                    estimatedDelivery: 'June 3, 2025',
                    customerName: 'Karan Kumar',
                    products: [
                        { name: 'Organic Fertiliser (5kg)', qty: 2, price: 350.00, img: 'https://via.placeholder.com/80x80?text=Fertiliser' },
                        { name: 'Hybrid Seeds Pack (Corn)', qty: 1, price: 250.00, img: 'https://via.placeholder.com/80x80?text=Seeds' },
                        { name: 'Gardening Gloves (Pair)', qty: 1, price: 100.00, img: 'https://via.placeholder.com/80x80?text=Gloves' },
                        { name: 'Pesticide (1L)', qty: 1, price: 200.00, img: 'https://via.placeholder.com/80x80?text=Pesticide' }
                    ]
                };
                currentOrderData = defaultOrder;
                populateOrderDetails(defaultOrder);
                updateTrackingTimeline(defaultOrder.status);
                renderProductList(defaultOrder.products);
                toggleDownloadButton(defaultOrder.status);
            }
        });

        function populateOrderDetails(data) {
            document.getElementById('orderIdDisplay').textContent = data.orderId || '#N/A';
            document.getElementById('orderDateDisplay').textContent = data.orderDate || 'N/A';
            document.getElementById('orderTotalDisplay').textContent = data.total ? `₹${parseFloat(data.total).toFixed(2)}` : '₹0.00';
            document.getElementById('paymentMethodDisplay').textContent = data.payment || 'N/A';
            document.getElementById('shippingAddressDisplay').textContent = data.shippingAddress || 'N/A';

            const statusElement = document.getElementById('currentOrderStatus');
            statusElement.textContent = data.status || 'N/A';
            statusElement.className = 'status-text';
            if (data.status) {
                statusElement.classList.add('status-' + data.status.toLowerCase().replace(/\s/g, '-'));
            }

            document.getElementById('estimatedDeliveryDisplay').textContent = data.estimatedDelivery || 'N/A';
        }

        function updateTrackingTimeline(currentStatus) {
            const statusMap = {
                "Order Placed": "step-placed",
                "Processing": "step-processing",
                "Shipped": "step-shipped",
                "Out for Delivery": "step-out-for-delivery",
                "Delivered": "step-delivered"
            };

            let foundCurrent = false;
            for (const key in statusMap) {
                const stepId = statusMap[key];
                const stepElement = document.getElementById(stepId);
                if (stepElement) {
                    stepElement.classList.remove('completed', 'active', 'delivered');

                    if (!foundCurrent) {
                        stepElement.classList.add('completed');
                    }

                    if (key === currentStatus) {
                        stepElement.classList.add('active');
                        foundCurrent = true;
                    }

                    if (key === "Delivered" && currentStatus === "Delivered") {
                        stepElement.classList.add('delivered');
                        stepElement.classList.remove('active', 'completed');
                    }
                }
            }
        }

        function renderProductList(products) {
            const productListElement = document.getElementById('productList');
            if (!productListElement) return;

            productListElement.innerHTML = '';
            if (products && products.length > 0) {
                products.forEach(item => {
                    const listItem = document.createElement('li');
                    listItem.classList.add('product-item');
                    listItem.innerHTML = `
                        <img src="${item.img || 'https://via.placeholder.com/80x80?text=Product'}" alt="${item.name}">
                        <div class="product-info">
                            <h3>${item.name}</h3>
                            <p>Qty: ${item.qty}</p>
                            <p class="price">₹${parseFloat(item.price).toFixed(2)}</p>
                        </div>
                    `;
                    productListElement.appendChild(listItem);
                });
            } else {
                productListElement.innerHTML = '<p style="text-align: center; color: var(--text-grey);">No items found for this order.</p>';
            }
        }

        function toggleDownloadButton(status) {
            const downloadButtonContainer = document.getElementById('downloadButtonContainer');
            if (status && status.toLowerCase() === 'delivered') {
                downloadButtonContainer.style.display = 'block';
            } else {
                downloadButtonContainer.style.display = 'none';
            }
        }

        function downloadOrderBillHtml(orderData) {
            if (!orderData) {
                console.error("No order data available to generate bill.");
                alert("Order details are not available to generate the bill. Please try refreshing the page.");
                return;
            }

            const orderId = orderData.orderId || '#N/A';
            const orderDate = orderData.orderDate || 'N/A';
            const total = orderData.total ? `₹${parseFloat(orderData.total).toFixed(2)}` : '₹0.00';
            const shippingAddress = orderData.shippingAddress || 'N/A';
            const paymentMethod = orderData.payment || 'N/A';
            const customerName = orderData.customerName || 'Valued Customer';

            const products = orderData.products || [];
            let itemsHtml = products.map(item => `
                <tr>
                    <td>${item.name}</td>
                    <td style="text-align:center;">${item.qty}</td>
                    <td style="text-align:right;">₹${parseFloat(item.price).toFixed(2)}</td>
                    <td style="text-align:right;">₹${(item.qty * parseFloat(item.price)).toFixed(2)}</td>
                </tr>
            `).join('');

            const today = new Date();
            const indianDate = today.toLocaleDateString('en-IN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            

            const billHtml = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Invoice - ${orderId}</title>
                    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
                    <style>
                        body {
                            font-family: 'Open Sans', Arial, sans-serif;
                            margin: 0;
                            padding: 20px;
                            background-color: #f4f4f4;
                            color: #333;
                            font-size: 14px;
                        }
                        .invoice-container {
                            max-width: 850px;
                            margin: 30px auto;
                            background-color: #ffffff;
                            border-radius: 10px;
                            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                            padding: 40px;
                            border-top: 5px solid #28a745;
                        }
                        .invoice-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: flex-start;
                            margin-bottom: 30px;
                            padding-bottom: 20px;
                            border-bottom: 1px solid #eee;
                        }

                        .invoice-header h1 {
                            font-family: 'Montserrat', sans-serif;
                            font-size: 36px;
                            color: #28a745;
                            margin: 0;
                            text-align: left;
                            flex-grow: 1;
                        }
                        .company-info {
                            text-align: right;
                            font-size: 13px;
                            line-height: 1.6;
                        }
                        .company-info strong {
                            font-size: 16px;
                            color: #555;
                        }
                        .billing-shipping-info {
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 30px;
                            flex-wrap: wrap;
                        }
                        .billing-shipping-info > div {
                            flex: 1;
                            min-width: 250px;
                            padding-right: 20px;
                            line-height: 1.6;
                        }
                        .billing-shipping-info h3 {
                            font-family: 'Montserrat', sans-serif;
                            font-size: 18px;
                            color: #555;
                            margin-bottom: 10px;
                            border-bottom: 2px solid #e0ffe0;
                            padding-bottom: 5px;
                        }
                        .invoice-details {
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 30px;
                            background-color: #f0fff0;
                            padding: 15px 20px;
                            border-radius: 8px;
                            border: 1px solid #d4edda;
                        }
                        .invoice-details div {
                            flex: 1;
                            text-align: center;
                            padding: 0 10px;
                        }
                        .invoice-details strong {
                            display: block;
                            font-size: 13px;
                            color: #777;
                            margin-bottom: 5px;
                            text-transform: uppercase;
                        }
                        .invoice-details span {
                            font-size: 16px;
                            font-weight: 600;
                            color: #333;
                        }
                        .items-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 30px;
                        }
                        .items-table th, .items-table td {
                            border: 1px solid #eee;
                            padding: 12px 15px;
                            text-align: left;
                        }
                        .items-table th {
                            background-color: #28a745;
                            color: white;
                            font-family: 'Montserrat', sans-serif;
                            font-weight: 600;
                            text-transform: uppercase;
                            font-size: 13px;
                        }
                        .items-table tbody tr:nth-child(even) {
                            background-color: #f9fff9;
                        }
                        .items-table td:nth-child(1) {
                            text-align: left;
                        }
                        .items-table td:nth-child(2) { text-align: center; }
                        .items-table td:nth-child(3), .items-table td:nth-child(4) { text-align: right; }
                        .totals-section {
                            display: flex;
                            justify-content: flex-end;
                            margin-bottom: 30px;
                        }
                        .totals-table {
                            width: 300px;
                            border-collapse: collapse;
                        }
                        .totals-table tr td {
                            padding: 8px 15px;
                            border: none;
                            text-align: right;
                        }
                        .totals-table tr:last-child td {
                            border-top: 2px solid #28a745;
                            font-size: 1.3em;
                            font-weight: bold;
                            color: #28a745;
                        }
                        .totals-table td:first-child {
                            text-align: left;
                            color: #555;
                        }
                        .footer-note {
                            text-align: center;
                            margin-top: 40px;
                            padding-top: 20px;
                            border-top: 1px dashed #ddd;
                            font-size: 13px;
                            color: #666;
                            line-height: 1.5;
                        }
                        .footer-note a {
                            color: #007bff;
                            text-decoration: none;
                        }
                        .footer-note a:hover {
                            text-decoration: underline;
                        }
                        @media print {
                            body {
                                background-color: white;
                                margin: 0;
                                padding: 0;
                            }
                            .invoice-container {
                                box-shadow: none;
                                border: 1px solid #eee;
                            }
                        }
                        @media (max-width: 600px) {
                            .invoice-container { padding: 20px; }
                            .invoice-header { flex-direction: column; align-items: center; text-align: center; }
                            .company-info { text-align: center; margin-top: 15px; }
                            .billing-shipping-info { flex-direction: column; }
                            .billing-shipping-info > div { padding-right: 0; margin-bottom: 20px; }
                            .invoice-details { flex-direction: column; text-align: center; }
                            .invoice-details div { margin-bottom: 10px; }
                            .items-table th, .items-table td { padding: 8px 10px; font-size: 12px; }
                        }
                    </style>
                </head>
                <body>
                    <div class="invoice-container">
                        <div class="invoice-header">
                            <h1>AGRO BILL</h1>
                            <div class="company-info">
                                <strong>AgroDirect Supplies</strong><br>
                                Baroda city<br>
                                
                                Phone: 8200428973 <br>
                                Email: agrofarm.ltd2@gmail.com
                            </div>
                        </div>

                        <div class="invoice-details">
                            <div>
                                <strong>Bill id #:</strong>
                                <span>${orderId}</span>
                            </div>
                            <div>
                                <strong>Bill issued Date:</strong>
                                <span>${indianDate}</span>
                            </div>
                            <div>
                                <strong>Order Date:</strong>
                                <span>${orderDate}</span>
                            </div>
                        </div>

                        <div class="billing-shipping-info">
                            <div>
                                <h3>Billed from:</h3>
                                <span>AGRO FARM.LTD</span><br>
                                <span>${shippingAddress.split(',').slice(0, 2).join(',')}</span><br>
                                <span>${shippingAddress.split(',').slice(2).join(',')}</span>
                            </div>

                            <div>
                                <h3>Billed To:</h3>
                                <span>  {{profile_name}}</span><br>
                                
                            </div>
                        </div>

                        <table class="items-table">
                            <thead>
                                <tr>
                                    <th>Item Description</th>
                                    <th>Qty</th>
                                    <th>Unit Price</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${itemsHtml}
                            </tbody>
                        </table>

                        <div class="totals-section">
                            <table class="totals-table">
                                <tr>
                                    <td>Price :</td>
                                    <td>₹${(products.reduce((sum, item) => sum + (item.qty * parseFloat(item.price)), 0)).toFixed(2)}</td>
                                </tr>
                                <tr>
                                    <td>Shipping :</td>
                                    <td>₹00.00</td>
                                </tr>
                                
                                <tr>
                                    <td>Total:</td>
                                    <td>${total}</td>
                                </tr>
                            </table>
                        </div>

                        <div class="footer-note">
                            <p>Thank you for your business! All payments are due within 15 days of invoice date.</p>
                            <p>For any queries, please contact us at <a href="mailto:support@agrodirect.com">agrofarm.ltd2@gmail.com</a></p>
                        </div>
                    </div>
                </body>
                </html>
            `;

            const blob = new Blob([billHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Invoice_${orderId}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>